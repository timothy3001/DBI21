CREATE OR REPLACE PROCEDURE AnalyseTx(INdelta IN NUMBER, OUTCount OUT NUMBER)
BEGIN
SELECT COUNT(*) INTO OUTCount FROM history WHERE delta = INdelta;
END;


CREATE OR REPLACE PROCEDURE BalanceTx(INaccId IN NUMBER, OUTBalance)
BEGIN
SELECT balance INTO OUTBalance FROM accounts WHERE accid = INaccId;
END;


CREATE OR REPLACE PROCEDURE InpaymentTx(INdelta IN NUMBER, INbranchId IN NUMBER, INtellerId IN NUMBER, INaccId IN NUMBER, OUTBalance INOUT NUMBER)
BEGIN

UPDATE branches SET balance = balance + INdelta WHERE branchid = INbranchId;
UPDATE tellers SET balance = balance + INdelta WHERE tellerid = INtellerId;
UPDATE accounts SET balance = balance + INdelta WHERE accid = INaccId;

SELECT balance INTO OUTBalance FROM accounts WHERE accid = INaccId;

INSERT INTO history (accid, tellerid, delta, branchid, accbalance, cmmnt) VALUES(INaccId, INtellerId, INdelta, INbranchId, OUTBalance, 'INPAYMENT');

END;
